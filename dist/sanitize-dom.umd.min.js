(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
	typeof define === 'function' && define.amd ? define(['exports'], factory) :
	(factory((global.sanitizeDom = {})));
}(this, (function (exports) { 'use strict';

function sanitizeDom(doc,node){var mode=2<arguments.length&&arguments[2]!==void 0?arguments[2]:'node',opts=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};function compileAndCacheRegex(str){var re=regexps[str];return re||(re=new RegExp('^'+str+'$','g'), regexps[str]=re), re}function getValuesForTagname(obj,tagname){for(var tag_rx_strs=Object.getOwnPropertyNames(obj),values=[],i=0;i<tag_rx_strs.length;i++){var tag_rx_str=tag_rx_strs[i],tag_rx=compileAndCacheRegex(tag_rx_str);tagname.match(tag_rx)&&(values=values.concat(obj[tag_rx_str]));}return values}function getValueRegexsForTagname(obj,tagname){var regex_strs=getValuesForTagname(obj,tagname),regexes=regex_strs.map(function(rx_str){return compileAndCacheRegex(rx_str)});return regexes}function matchesAny(obj,tagname,val){return getValueRegexsForTagname(obj,tagname).some(function(rx){return null!=val.match(rx)})}function childrenOf(node){for(var child,children=[],i=0;i<node.childNodes.length;i++)child=node.childNodes[i], children.push(child);return children}function replaceWithNodes(replaceable,replacements){for(var n,i=0;i<replacements.length;i++)n=replacements[i], replaceable.parentNode.insertBefore(n,replaceable);replaceable.remove();}function runFiltersOnNode(nd,filters){var removed=!1,sanitize_skip_filters=nd.sanitize_skip_filters;if(delete nd.sanitize_skip_filters, sanitize_skip_filters)return!1;for(var replacements=[],i=0;i<filters.length;i++){var filter=filters[i],result=filter(nd,parents,parent_nodenames);if(result===nd){var _sanitize_skip_filters=nd.sanitize_skip_filters;if(delete nd.sanitize_skip_filters, _sanitize_skip_filters)break;else continue}else result instanceof Array?(replaceWithNodes(nd,result), removed=!0, replacements=replacements.concat(result)):result?(nd.parentNode.replaceChild(result,nd), removed=!0, replacements.push(result)):(nd.remove(), removed=!0);for(var r,_i=0;_i<replacements.length;_i++){if(r=replacements[_i], r.nodeName==nd.nodeName&&'undefined'==typeof r.sanitize_skip_filters)throw new Error('Prevented possible infinite loop. Filter function \''+(filter.prototype.constructor.name||'anonymous')+'\' has returned a node of type \''+r.nodeName+'\' which has the same nodeName as the original node. This can lead to an infinite loop if the filter always returns the same result. To get rid of this warning, the filter must set the property \'sanitize_skip_filters\' on the returned node (evaluating to true or false) to signal if the returned node is to be sanitized again (false) or not (true).');sanitizeNode(r);}break}return removed}function filterClassesForNode(nd){for(var kls,classes=[],i=0;i<nd.classList.length;i++)kls=nd.classList[i], classes.push(kls);for(var _i2=0;_i2<classes.length;_i2++){var classname=classes[_i2],keep=matchesAny(opts.allow_classes_by_tag,nd.nodeName,classname);if(!keep){nd.classList.remove(classname);continue}}nd.hasAttribute('class')&&0===nd.classList.length&&nd.attributes.removeNamedItem('class');}function filterAttributesForNode(nd){for(var attname,i=0;i<nd.attributes.length;i++)if(attname=nd.attributes[i].name, 'class'!=attname&&!matchesAny(opts.allow_attributes_by_tag,nd.nodeName,attname)){nd.attributes.removeNamedItem(attname);continue}}function childNodesToFragment(nd){for(var c,fragment=doc.createDocumentFragment(),children=childrenOf(nd),i=0;i<children.length;i++)c=children[i], fragment.appendChild(c);return fragment}function childNodesToSanitizedSiblings(nd){var fragment=childNodesToFragment(nd);sanitizeChildNodes(fragment), nd.parentNode.insertBefore(fragment,nd), nd.remove();}function joinSiblings(parent,tags){for(var children=childrenOf(parent),i=0;i<children.length;i++){var nd=children[i],nd1=children[i+1],nd2=children[i+2];if(nd1&&nd.nodeName==nd1.nodeName&&tags.includes(nd.nodeName)&&tags.includes(nd1.nodeName)){for(var c,_children=childrenOf(nd1),_i3=0;_i3<_children.length;_i3++)c=_children[_i3], nd.appendChild(c);return nd1.remove(), void joinSiblings(parent,tags)}if(nd1&&nd2&&nd.nodeName==nd2.nodeName&&3==nd1.nodeType&&nd1.textContent.match(/^\s+$/)&&tags.includes(nd2.nodeName)){nd.appendChild(nd1);for(var _c,_children2=childrenOf(nd2),_i4=0;_i4<_children2.length;_i4++)_c=_children2[_i4], nd.appendChild(_c);return nd2.remove(), void joinSiblings(parent,tags)}}}function sanitizeNode(nd){if(nd.sanitize_skip)return void delete nd.sanitize_skip;var tagname=nd.nodeName;3==nd.nodeType&&(tagname='TEXT');var filters=getValuesForTagname(opts.filters_by_tag,tagname);return runFiltersOnNode(nd,filters)||3==nd.nodeType?void 0:matchesAny(opts.remove_tags_direct,parents[0].nodeName,tagname)||parent_nodenames.some(function(pnn){return matchesAny(opts.remove_tags_deep,pnn,tagname)})?void nd.remove():matchesAny(opts.flatten_tags_direct,parents[0].nodeName,tagname)||parent_nodenames.some(function(pnn){return matchesAny(opts.flatten_tags_deep,pnn,tagname)})?void childNodesToSanitizedSiblings(nd):matchesAny(opts.allow_tags_direct,parents[0].nodeName,tagname)||parent_nodenames.some(function(pnn){return matchesAny(opts.allow_tags_deep,pnn,tagname)})?(nd.sanitize_skip_filter_classes||filterClassesForNode(nd), nd.sanitize_skip_filter_attributes||filterAttributesForNode(nd), parents.unshift(nd), parent_nodenames.unshift(nd.nodeName), sanitizeChildNodes(nd), parents.shift(), void parent_nodenames.shift()):void childNodesToSanitizedSiblings(nd)}function sanitizeChildNodes(parent){for(var nd,allow_empty_tags=['IMG','IFRAME','HR','BR'],children=childrenOf(parent),i=0;i<children.length;i++)nd=children[i], sanitizeNode(nd), opts.remove_empty&&1==nd.nodeType&&!allow_empty_tags.includes(nd.nodeName)&&0==nd.childNodes.length&&nd.remove();0<opts.join_siblings.length&&joinSiblings(parent,opts.join_siblings);}if(!(doc&&'function'==typeof doc.createElement))throw new Error('Need DOM Document interface');if(!(node&&'function'==typeof node.normalize))throw new Error('Need DOM Node interface');opts.filters_by_tag||(opts.filters_by_tag={}), opts.remove_tags_direct||(opts.remove_tags_direct={}), opts.remove_tags_deep||(opts.remove_tags_deep={".*":['style','script','textarea','noscript']}), opts.flatten_tags_direct||(opts.flatten_tags_direct={}), opts.flatten_tags_deep||(opts.flatten_tags_deep={}), opts.allow_tags_direct||(opts.allow_tags_direct={}), opts.allow_tags_deep||(opts.allow_tags_deep={}), opts.allow_attributes_by_tag||(opts.allow_attributes_by_tag={}), opts.allow_classes_by_tag||(opts.allow_classes_by_tag={}), opts.join_siblings||(opts.join_siblings=[]);var parents=[],parent_nodenames=[],regexps={};parents.unshift(node), parent_nodenames.unshift(node.nodeName), 'node'==mode?sanitizeNode(node):'children'==mode&&sanitizeChildNodes(node);}

function sanitizeNode(doc,node){var opts=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};sanitizeDom(doc,node,'node',opts);}function sanitizeChildNodes(doc,node){var opts=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};sanitizeDom(doc,node,'children',opts);}function sanitizeHtml(doc,html){var opts=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};if(!(doc&&'function'==typeof doc.createElement))throw new Error('Need DOM Document interface');var sandboxdom=doc.implementation.createHTMLDocument('');sandboxdom.documentElement.innerHTML=html, sanitizeDom(doc,sandboxdom.body,'children',opts);for(var node,childrefs=[],i=0;i<sandboxdom.body.childNodes.length;i++)node=sandboxdom.body.childNodes[i], childrefs.push(node);return childrefs}

exports.sanitizeDom = sanitizeDom;
exports.sanitizeNode = sanitizeNode;
exports.sanitizeChildNodes = sanitizeChildNodes;
exports.sanitizeHtml = sanitizeHtml;

Object.defineProperty(exports, '__esModule', { value: true });

})));
//# sourceMappingURL=sanitize-dom.umd.min.js.map
